<p-toast [breakpoints]="{'920px': {width: '100%', right: '0', left: '0'}}"></p-toast>
<p-confirmDialog [style]="{width: '450px'}"></p-confirmDialog>
<div class="card" *ngIf="models">
  <p-dataView #dv [value]="models" [paginator]="true" [rows]="8" filterBy="attributes.name" [sortField]="sortField"
    [sortOrder]="sortOrder" layout="grid">
    <ng-template pTemplate="header">
      <div class="flex flex-column md:flex-row md:justify-content-between">
        <p-dropdown [options]="sortOptions" [(ngModel)]="sortField" placeholder="Trier par Nom"
          (onChange)="onSortChange($event)" styleClass="mb-2 md:mb-0"></p-dropdown>
        <span class="p-input-icon-left mb-2 md:mb-0">
          <i class="pi pi-search"></i>
          <input type="search" pInputText placeholder="Filtrer par Nom" (input)="dv.filter($any($event.target).value)">
        </span>
        <p-dataViewLayoutOptions></p-dataViewLayoutOptions>
        <p-button icon="pi pi-refresh" (click)="getModels()" label="Actualiser" class="p-button-text"></p-button>
        <p-button icon="pi pi-plus" (click)="addNewModel()" label="Nouveau" class="p-button-text"></p-button>
      </div>
    </ng-template>
    <ng-template let-models pTemplate="listItem">
      <div class="p-col-12">
        <div class="model-list-item" *ngFor="let model of models">
          <div class="model-list-detail">
            <div class="text-3xl">{{model?.attributes?.name}}</div>
            <div class="text-xl">{{model?.attributes?.description}}</div>
            <hr>
            <div [innerHTML]="secureHtml(model?.attributes?.data_text)"></div>
            <div *ngIf='model?.attributes?.data_html' [innerHTML]="secureHtml(model?.attributes?.data_html)"></div>
            <hr>
          </div>
          <p-button (click)="setModel(model)" styleClass="p-button-text" icon="pi pi-arrow-circle-right" iconPos="right"
            label="Selectionner ce modèle"></p-button>
          <p-button (click)="deleteModel(model)" styleClass="p-button-text p-button-danger" icon="pi pi-trash"
            iconPos="right" label="Supprimer ce modèle #{{model.id}}"></p-button>
        </div>
      </div>
    </ng-template>
    <ng-template let-models pTemplate="gridItem">
      <div class="grid">
        <div class="col-12 md:col-4 p-2" *ngFor="let model of models">
          <div class="card model-grid-item p-2 shadow-7">
            <div class="model-grid-item-top">
              <div class="text-3xl">{{model?.attributes?.name}}</div>
              </div>
              <div class="model-grid-item-content">
              <div class="text-xl">{{model?.attributes?.description}}</div>
              <hr>
              <div [innerHTML]="secureHtml(model?.attributes?.data_text)"></div>
              <div *ngIf='model?.attributes?.data_html' [innerHTML]="secureHtml(model?.attributes?.data_html)"></div>
              </div>
              <hr>
            <p-button (click)="setModel(model)" styleClass="p-button-text" icon="pi pi-arrow-circle-right" iconPos="right"
              label="Selectionner ce modèle"></p-button>
            <p-button (click)="deleteModel(model)" styleClass="p-button-text p-button-danger" icon="pi pi-trash" iconPos="right"
              label="Supprimer ce modèle #{{model.id}}"></p-button>
          </div>
        </div>
      </div>
    </ng-template>
  </p-dataView>
</div>

<p-dialog header="Gestion des modèles" [(visible)]="displayModal" [modal]="true" [style]="{width: '90vw'}"
  [baseZIndex]="10000" [draggable]="true" [resizable]="true">
    <form [formGroup]="currentModel" (ngSubmit)="onSubmit()">
      <div class="field">
        <label for="name">Nom du modèle</label>
        <input type="text" pInputText id="name" formControlName="name" required autofocus
          [ngClass]="{ 'is-invalid': submitted && f['name'].errors }" />
        <!-- <small class="p-error" *ngIf="submitted && !storeItem.name">Name is required.</small> -->
        </div>
        <div class="field">
          <label for="description">Description</label>
        <input type="text" pInputText id="description" formControlName="description" required autofocus
          [ngClass]="{ 'is-invalid': submitted && f['description'].errors }" />
        <!-- <small class="p-error" *ngIf="submitted && !storeItem.description">Description is required.</small> -->
        </div>
      <p-editor #ed formControlName="data_text" [style]="{'height':'320px'}" (onTextChange)="onTextChange($event)"></p-editor>
      <p-editor #ed formControlName="data_html" [style]="{'height':'320px'}" (onTextChange)="onTextChange($event)"></p-editor>
      </form>
      <ng-template pTemplate="footer">
      <p-button icon="pi pi-check" (onClick)="onSubmit()" label="Mettre à jour" class="p-button-text"></p-button>
      <p-button icon="pi pi-times" (click)="displayModal=false" label="Annuler"></p-button>
      </ng-template>
</p-dialog>